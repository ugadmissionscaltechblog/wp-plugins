class molonguiAuthorshipPostEdit{constructor(){jQuery(document).ready(()=>{this.initEventListeners(),this.initDomElements()})}initEventListeners(){jQuery(document).ajaxSend((t,o,e)=>{var a;-1!=e.url.indexOf(molongui_authorship_edit_post_params.ajax_suggest_link)&&(a=jQuery('input[name^="authors["]').map(function(){return this.value}).get(),e.url=e.url.split("&existing_authors")[0],e.url+="&existing_authors="+a.join(","),jQuery("#authors-loading").css("visibility","visible"))}),jQuery(document).ajaxComplete((t,o,e)=>{-1!=e.url.indexOf(molongui_authorship_edit_post_params.ajax_suggest_link)&&jQuery("#authors-loading").css("visibility","hidden")}),jQuery(document).on("click.molongui",".molongui-post-authors__up",t=>{var t=jQuery(t.target).closest(".molongui-post-authors__item"),o=t.prev(".molongui-post-authors__item");0!==o.length&&t.insertBefore(o)}),jQuery(document).on("click.molongui",".molongui-post-authors__down",t=>{var t=jQuery(t.target).closest(".molongui-post-authors__item"),o=t.next(".molongui-post-authors__item");0!==o.length&&t.insertAfter(o)}),jQuery(document).on("click.molongui",".molongui-post-authors__delete",t=>{t.preventDefault(),this.deleteAuthorOnClick(t)}),jQuery(document).on("click.molongui",".molongui-post-authors__add-new",()=>{jQuery(".molongui-post-authors__add-new span").toggleClass("dashicons-minus dashicons-plus-alt2"),jQuery(".molongui-post-authors__add-form").slideToggle("slow")}),jQuery(document).on("keydown.molongui","input, button",this.disableKeydown),jQuery(document).on("click.molongui",".molongui-post-authors__add-form button",t=>{t.preventDefault(),this.addNewAuthor()})}initDomElements(){this.initSearchBox(jQuery(".molongui-post-authors__input")),this.initSortableList(jQuery("#molongui-post-authors"))}initAuthorSelector(t){t&&(this.initSearchBox(t.find(".molongui-post-authors__input")),this.initSortableList(t.find(".molongui-post-authors__list")))}initSearchBox(t){t&&t.suggest(molongui_authorship_edit_post_params.ajax_suggest_link,{onSelect:()=>{this.autosuggestSelect(t[0],t)},delay:200,maxCacheSize:0}).on("keydown",this.disableKeydown.bind(this))}autosuggestSelect(t,o){var e,t=t.value.split("âˆ£");1<t.length&&((e={}).name=t[0].trim(),e.type=t[1].trim(),e.id=t[2].replace(/\(#(\d+)\)/,"$1").trim(),e.email=t[3].trim(),e.login=t[4].trim(),e.nicename=decodeURIComponent(t[5].trim()),""!==e.avatar&&(e.avatar=t[6].trim()),e.type="Guest author"===e.type?"guest":"user",0===jQuery(".molongui-post-authors__list").find(".molongui-post-authors__item[data-author-ref="+e.type+"-"+e.id+"]").length)&&this.addAuthor(e),o.val("").blur(),this.resetSearchBox(o)}disableKeydown(t){if(13===t.keyCode)return!1}addAuthor(t){let o="";t.avatar&&(e=jQuery("<img />").attr("src",t.avatar),o=jQuery("<div/>").addClass("molongui-post-authors__avatar").append(e));var e=jQuery("<div/>").addClass("molongui-post-authors__name").text(decodeURIComponent(t.name)).attr("title",molongui_authorship_edit_post_params.tag_title),a=jQuery("<span> </span>").addClass("dashicons").addClass("dashicons-arrow-up-alt2").addClass("molongui-post-authors__up").attr("title",molongui_authorship_edit_post_params.up_label),s=jQuery("<span> </span>").addClass("dashicons").addClass("dashicons-arrow-down-alt2").addClass("molongui-post-authors__down").attr("title",molongui_authorship_edit_post_params.down_label),i=jQuery("<span> </span>").addClass("dashicons").addClass("dashicons-no-alt").addClass("molongui-post-authors__delete").attr("title",molongui_authorship_edit_post_params.delete_label),a=jQuery("<div/>").addClass("molongui-post-authors__actions").append(a).append(s).append(i),s=jQuery("<input />").attr({type:"hidden",name:"molongui_post_authors[]",value:t.type+"-"+t.id}),i=jQuery("<div/>").addClass("molongui-post-authors__row").append(o).append(e).append(a).append(s),e=jQuery("<div/>").attr("id",t.type+"-"+t.id).addClass("molongui-post-authors__item").addClass("molongui-post-authors__item--"+t.type).attr("data-author-id",t.id).attr("data-author-type",t.type).attr("data-author-ref",t.type+"-"+t.id).append(i);molongui_authorship_edit_post_params.coauthors_enabled?(jQuery(".molongui-post-authors__list").first().append(e),molongui_authorship_edit_post_params.debug_mode&&console.log("Author added: "+t.name+" ("+t.type+", #"+t.id+")")):(jQuery(".molongui-post-authors__list").first().empty().append(e),molongui_authorship_edit_post_params.debug_mode&&console.log("Author replaced with: "+t.name+" ("+t.type+", #"+t.id+")"))}resetSearchBox(t){var o=t.clone();o.insertBefore("#authors-loading"),this.initSearchBox(o),t.remove()}initSortableList(t){t&&t.sortable({axis:"y",tolerance:"pointer",items:"div.molongui-post-authors__item:not(#molongui-post-authors div.molongui-post-authors__item:only-child)",containment:"parent",handle:".molongui-post-authors__row",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,cursor:"move"})}deleteAuthorOnClick(t){let o=molongui_authorship_edit_post_params.confirm_delete;return 1===jQuery(".molongui-post-authors__list .molongui-post-authors__item").length&&(o=molongui_authorship_edit_post_params.one_author_required),!!confirm(o)&&this.deleteAuthor(t.target)}deleteAuthor(t){t=jQuery(t).closest(".molongui-post-authors__item");return t.remove(),jQuery(document).trigger("authorDeleted",[t]),!0}addNewAuthor(){const o=jQuery("[name=molongui-new-author-name]"),e=jQuery("[name=molongui-new-author-type]"),a=jQuery("[name=molongui-new-author-email]");let t=!1;if(0===o.val().trim().length?(o.css("border","2px solid red"),t=!0):o.css("border","inherit"),0===e.val().trim().length?(e.css("border","2px solid red"),t=!0):e.css("border","inherit"),"user"===e.val()&&0===a.val().trim().length?(a.css("border","2px solid red"),t=!0):a.css("border","inherit"),t)return alert(molongui_authorship_edit_post_params.new_author_required),!1;if(0!==a.val().trim().length){if(!/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+$/.test(a.val()))return a.css("border","2px solid red"),alert(molongui_authorship_edit_post_params.new_author_wrong_email),!1}else a.css("border","inherit");if(confirm(molongui_authorship_edit_post_params.new_author_confirm)){const s=jQuery(".molongui-post-authors__add-form button"),i=s.html();s.html('<div class="molongui-post-authors-spinner"></div>'),jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"molongui_authorship_quick_add_author",author_name:o.val(),author_type:e.val(),author_email:a.val(),nonce:jQuery("#molongui_authorship_quick_add_author_nonce").val()},success:t=>{t=JSON.parse(t);"error"===t.result?(alert(t.message),s.html(i)):(this.addAuthor({id:t.author_id,type:t.author_type,ref:t.author_ref,name:t.author_name}),jQuery.each([o,e,a],function(t,o){o.css("border","inherit"),o.val("")}),s.html(i),jQuery(".molongui-post-authors__add-new span").attr("class","dashicons dashicons-plus-alt2"),jQuery(".molongui-post-authors__add-form").slideToggle(),alert(t.message))},error:(t,o,e)=>{s.html(i),alert(molongui_authorship_edit_post_params.new_author_ajax_error)}})}}}jQuery(document).ready(()=>{window.molonguiAuthorshipPostEdit=new molonguiAuthorshipPostEdit}),window.molonguiAuthorshipInitAuthorSelector=t=>{window.molonguiAuthorshipPostEdit&&window.molonguiAuthorshipPostEdit.initAuthorSelector(t)};